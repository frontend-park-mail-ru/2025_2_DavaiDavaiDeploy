function t(t,e,n,r=null){function o(){r?e.apply(r,arguments):e(...arguments)}return n.addEventListener(t,o),o}const e="add",n="remove",r="move",o="noop";function s(t){return t.filter(t=>null!=t)}class i{#t=[];#e=[];#n;constructor(t,e){this.#t=[...t],this.#e=t.map((t,e)=>e),this.#n=e}isAddition(t,e){return-1===this.findIndexFrom(t,e)}isNoop(t,e){if(t>=this.length)return!1;const n=this.#t[t],r=e[t];return this.#n(n,r)}isRemoval(t,e){if(t>=this.length)return!1;const n=this.#t[t];return-1===e.findIndex(t=>this.#n(n,t))}findIndexFrom(t,e){for(let n=e;n<this.length;n++)if(this.#n(t,this.#t[n]))return n;return-1}originalIndexAt(t){return this.#e[t]}noopItem(t){return{op:o,originalIndex:this.originalIndexAt(t),index:t,item:this.#t[t]}}removeItemsAfter(t){const e=[];for(;this.length>t;)e.push(this.removeItem(t));return e}removeItem(t){const e={op:n,index:t,item:this.#t[t]};return this.#t.splice(t,1),this.#e.splice(t,1),e}addItem(t,n){const r={op:e,index:n,item:t};return this.#t.splice(n,0,t),this.#e.splice(n,0,-1),r}moveItem(t,e){const n=this.findIndexFrom(t,e),o={op:r,originalIndex:this.originalIndexAt(n),from:n,index:e,item:this.#t[n]},[s]=this.#t.splice(n,1);this.#t.splice(e,0,s);const[i]=this.#e.splice(n,1);return this.#e.splice(e,0,i),o}get length(){return this.#t.length}}const c="text",u="element",a="fragment",l="component";function f(t,e={},n=[]){return{tag:t,props:e,type:"string"==typeof t?u:l,children:p(s(n))}}function d(t){return{type:c,value:t}}function h(t){return{type:a,children:p(s(t))}}function p(t){return t.map(t=>"string"==typeof t?d(t):t)}function m(t){if(null==t.children)return[];const e=[];for(const n of t.children)n.type===a?e.push(...m(n)):e.push(n);return e}function y(t){const{type:e}=t;switch(e){case c:!function(t){const{el:e}=t;e.remove()}(t);break;case u:!function(t){const{el:e,children:n,listeners:r}=t;e.remove(),n.forEach(y),r&&(!function(t={},e){Object.entries(t).forEach(([t,n])=>{e.removeEventListener(t,n)})}(r,e),delete t.listeners)}(t);break;case a:!function(t){const{children:e}=t;e.forEach(y)}(t);break;case l:t.component.unmount();break;default:throw new Error(`Can't destroy DOM of type: ${e}`)}delete t.el}class v{#r=new Map;#o=[];subscribe(t,e){this.#r.has(t)||this.#r.set(t,[]);const n=this.#r.get(t);return n.includes(e)?()=>{}:(n.push(e),()=>{const t=n.indexOf(e);n.splice(t,1)})}afterEveryCommand(t){return this.#o.push(t),()=>{const e=this.#o.indexOf(t);this.#o.splice(e,1)}}dispatch(t,e){this.#r.has(t)?this.#r.get(t).forEach(t=>t(e)):console.warn(`No handlers for command: ${t}`),this.#o.forEach(t=>t())}}function g(t,e,n){t.style[e]=n}function b(t,e){t.style[e]=null}function E(t,e){const{class:n,style:r,...o}=e;n&&function(t,e){t.className="","string"==typeof e&&(t.className=e);Array.isArray(e)&&t.classList.add(...e)}(t,n),r&&Object.entries(r).forEach(([e,n])=>{g(t,e,n)});for(const[e,n]of Object.entries(o))I(t,e,n)}function I(t,e,n){null==n?O(t,e):e.startsWith("data-")?t.setAttribute(e,n):t[e]=n}function O(t,e){t[e]=null,t.removeAttribute(e)}function w(e,n,r,o=null){switch(e.type){case c:!function(t,e,n){const{value:r}=t,o=document.createTextNode(r);t.el=o,x(o,e,n)}(e,n,r);break;case u:!function(e,n,r,o){const{tag:s,props:i,children:c}=e,u=document.createElement(s);(function(e,n,r,o){const{on:s,...i}=n;r.listeners=function(e={},n,r=null){const o={};return Object.entries(e).forEach(([e,s])=>{o[e]=t(e,s,n,r)}),o}(s,e,o),E(e,i)})(u,i,e,o),e.el=u,c.forEach(t=>w(t,u,null,o)),x(u,n,r)}(e,n,r,o);break;case a:!function(t,e,n,r){const{children:o}=t;t.el=e,o.forEach((t,o)=>w(t,e,n?n+o:null,r))}(e,n,r,o);break;case l:!function(t,e,n){const r=t.tag,o=t.props,s=new r(o);s.mount(e,n),t.component=s,t.el=s.firstElement}(e,n,r);break;default:throw new Error(`Can't mount DOM of type: ${e.type}`)}}function x(t,e,n){if(null==n)return void e.append(t);if(n<0)throw new Error(`Index must be a positive integer, got ${n}`);const r=e.childNodes;n>=r.length?e.append(t):e.insertBefore(t,r[n])}function A(t,e){if(t.type!==e.type)return!1;if(t.type===u){const{tag:n}=t,{tag:r}=e;return n===r}return!0}function k(t,e){const n=Object.keys(t),r=Object.keys(e),o=[],s=[];for(const n of r)n in t?n in t&&t[n]!==e[n]&&s.push(n):o.push(n);return{added:o,removed:n.filter(t=>!(t in e)),updated:s}}function j(t){return function(t){return""!==t}(t.trim())}function M(s,a,f,d=null){if(!A(s,a)){const t=function(t,e){const n=Array.from(t.childNodes).indexOf(e);if(n<0)return null;return n}(f,s.el);return y(s),w(a,f,t,d),a}switch(a.el=s.el,a.type){case c:return function(t,e){const n=t.el,{value:r}=t,{value:o}=e;r!==o&&(n.nodeValue=o)}(s,a),a;case u:!function(e,n,r){const o=e.el,{class:s,style:i,on:c,...u}=e.props,{class:a,style:l,on:f,...d}=n.props,{listeners:h}=e;(function(t,e,n){const{added:r,removed:o,updated:s}=k(e,n);for(const e of o)O(t,e);for(const e of r.concat(s))I(t,e,n[e])})(o,u,d),function(t,e,n){const r=N(e),o=N(n),{added:s,removed:i}=(c=r,u=o,{added:u.filter(t=>!c.includes(t)),removed:c.filter(t=>!u.includes(t))});var c,u;i.length>0&&t.classList.remove(...i);s.length>0&&t.classList.add(...s)}(o,s,a),function(t,e={},n={}){const{added:r,removed:o,updated:s}=k(e,n);for(const e of o)b(t,e);for(const e of r.concat(s))g(t,e,n[e])}(o,i,l),n.listeners=function(e,n={},r={},o={},s){const{removed:i,added:c,updated:u}=k(r,o);for(const t of i.concat(u))e.removeEventListener(t,n[t]);const a={};for(const n of c.concat(u)){const r=t(n,o[n],e,s);a[n]=r}return a}(o,h,c,f,r)}(s,a,d);break;case l:!function(t,e){const{component:n}=t,{props:r}=e;n.updateProps(r),e.component=n,e.el=n.firstElement}(s,a)}return function(t,s,c){const u=m(t),a=m(s),l=t.el,f=function(t,e,n=(t,e)=>t===e){const r=[],o=new i(t,n);for(let t=0;t<e.length;t++){if(o.isRemoval(t,e)){r.push(o.removeItem(t)),t--;continue}if(o.isNoop(t,e)){r.push(o.noopItem(t));continue}const n=e[t];o.isAddition(n,t)?r.push(o.addItem(n,t)):r.push(o.moveItem(n,t))}return r.push(...o.removeItemsAfter(e.length)),r}(u,a,A);for(const t of f){const{from:s,originalIndex:i,index:f,item:d}=t,h=c?.offset??0;switch(t.op){case e:w(d,l,f+h,c);break;case n:y(d);break;case r:{const t=u[s].el,e=l.childNodes[f+h];l.insertBefore(t,e),M(u[s],a[f],l,c);break}case o:M(u[i],a[f],l,c)}}}(s,a,d),a}function N(t=""){return Array.isArray(t)?t.filter(j):t.split(/(\s+)/).filter(j)}function F({state:t,view:e,reducers:n={}}){let r=null,o=null;const s=new v,i=[s.afterEveryCommand(function(){const n=e(t,c);o=M(o,n,r)})];function c(t,e){s.dispatch(t,e)}for(const e in n){const r=n[e],o=s.subscribe(e,e=>{t=r(t,e)});i.push(o)}return{mount(n){r=n,o=e(t,c),mountDOM(o,r)},unmount(){y(o),o=null,i.forEach(t=>t())}}}function C(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var L,q;var H=(q||(q=1,L=function t(e,n){if(e===n)return!0;if(e&&n&&"object"==typeof e&&"object"==typeof n){if(e.constructor!==n.constructor)return!1;var r,o,s;if(Array.isArray(e)){if((r=e.length)!=n.length)return!1;for(o=r;0!==o--;)if(!t(e[o],n[o]))return!1;return!0}if(e.constructor===RegExp)return e.source===n.source&&e.flags===n.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===n.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===n.toString();if((r=(s=Object.keys(e)).length)!==Object.keys(n).length)return!1;for(o=r;0!==o--;)if(!Object.prototype.hasOwnProperty.call(n,s[o]))return!1;for(o=r;0!==o--;){var i=s[o];if(!t(e[i],n[i]))return!1}return!0}return e!=e&&n!=n}),L),S=C(H);class P{#s=!1;#i=null;#c=null;constructor(t={}){this.props=t}get elements(){return null==this.#i?[]:this.#i.type===a?m(this.#i).flatMap(t=>t.type===l?t.component.elements:[t.el]):[this.#i.el]}get firstElement(){return this.elements[0]}get offset(){return this.#i.type===a?Array.from(this.#c.children).indexOf(this.firstElement):0}updateProps(t){const e={...this.props,...t};S(this.props,e)||(this.props=e,this.#u())}setState(t){this.state={...this.state,...t},this.#u()}render(){return render.call(this)}mount(t,e=null){if(this.#s)throw new Error("Component is already mounted");this.#i=this.render(),w(this.#i,t,e,this),this.#c=t,this.#s=!0}unmount(){if(!this.#s)throw new Error("Component is not mounted");y(this.#i),this.#i=null,this.#c=null,this.#s=!1}#u(){if(!this.#s)throw new Error("Component is not mounted");const t=this.render();this.#i=M(this.#i,t,this.#c,this)}}export{P as Component,F as createApp,f as h,h as hFragment,d as hString};
